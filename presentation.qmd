---
title: "LLM AI vs in game AI Performance"
subtitle: "INFO 523 - Fall 2025 - Final Project"
author: "Sebastian Robinson"
title-slide-attributes:
  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg
  data-background-size: stretch
  data-background-opacity: "0.7"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
  
editor: visual
jupyter: python3
execute:
  echo: false
---

```{python}
#| label: load-packages
#| include: false

# Load packages here
import pandas as pd
import seaborn as sns
import os
import glob
import numpy as np
import pandas as pd
import sqlite3
from scipy import stats
from pandas.api.types import is_numeric_dtype
import seaborn as sns
from sklearn.cluster import KMeans
from sklearn.discriminant_analysis import StandardScaler
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
from scipy.cluster.hierarchy import linkage, dendrogram
BASE_DIR = os.getcwd()


metrics = [
    "Cities", "Population", "Territory",
    "Gold", "GoldPerTurn",
    "HappinessPercentage",
    "SciencePerTurn", "CulturePerTurn",
    "FaithPerTurn", "TourismPerTurn",
    "Technologies"
]

```

```{python}
#| label: setup
#| include: false
#| 
sns.set_theme(style="whitegrid")
sns.set_context("notebook", font_scale=1.1)

import matplotlib.pyplot as plt
plt.rcParams['figure.dpi'] = 300
plt.rcParams['savefig.dpi'] = 300
plt.rcParams['figure.figsize'] = (6, 6 * 0.618)
```

```{python}
#| label: load-data
#| include: false
csv_dir = os.path.join(BASE_DIR, "data", "csv_exports")
files = glob.glob(os.path.join(csv_dir, "*.csv"))
dfs = {os.path.basename(f): pd.read_csv(f) for f in files}

df_players = dfs["PlayerSummaries.csv"].copy()
df_cities  = dfs["CityInformations.csv"].copy()

player_cols = [f"Player{i}" for i in range(22)]

def get_active_player(row):
    for i, col in enumerate(player_cols):
        if col in row and row[col] == 2:
            return i
    return None

df_players["ActivePlayer"] = df_players.apply(get_active_player, axis=1)

df_players.head().to_html()
```

## Research Question

::: columns
How does a LLM perform against the base AI in Civilization 5?

-   Can the LLM's strategy change be detected
-   What Cause the change in strategy
:::


## Dataset Overview
::: {.r-fit-text}
::: columns
::: {.column width="50%"}
Data:

-   Dataset of one gameplay instance between 1 LLM and 3 in game AI's
-   This analysis focuses on resources from both players and cities over player turns
### PlayerSummaries Columns
```{python}
cols = df_players.columns.tolist()
cols[:5] + ["..."] + cols[-5:]
```
:::

::: {.column width="50%"}
### CityInformation Columns
```{python}
cols = df_cities.columns.tolist()
cols[:5] + ["..."] + cols[-5:]
```
:::



# Heatmap

```{python}
city_yields = (
    df_cities.groupby(["Turn", "Owner"])[[
        "Population","FoodPerTurn","ProductionPerTurn",
        "GoldPerTurn","SciencePerTurn","CulturePerTurn",
        "FaithPerTurn","TourismPerTurn","BuildingCount","WonderCount"
    ]]
    .mean()
    .reset_index()
)

city_yields.rename(columns={"Owner":"OwnerID"}, inplace=True)

df_players["ActivePlayer"] = df_players["ActivePlayer"].astype(int)
city_yields["OwnerID"] = city_yields["OwnerID"].astype(int)
df_players["Turn"] = df_players["Turn"].astype(int)
city_yields["Turn"] = city_yields["Turn"].astype(int)


def plot_heatmap(data, title):
    corr = data.corr()
    plt.figure(figsize=(10,8))
    sns.heatmap(corr, cmap="coolwarm", annot=False)
    plt.title(title)
    plt.show()

merged = pd.merge(
    df_players,
    city_yields,
    left_on=["Turn", "ActivePlayer"],
    right_on=["Turn", "OwnerID"],
    how="left"
)



valid_players = sorted(df_players["ActivePlayer"].dropna().unique())
df_filtered = merged[merged["ActivePlayer"].isin(valid_players)].copy()

df_filtered = df_filtered.drop(
    columns=[c for c in df_filtered.columns 
             if c.startswith("Player") 
             and int(c.replace("Player","")) not in valid_players],
    errors="ignore"
)

numeric_cols = df_filtered.select_dtypes("number").columns.tolist()

for col in ["Turn","ActivePlayer","OwnerID"]:
    if col in numeric_cols:
        numeric_cols.remove(col)

df_corr = df_filtered[numeric_cols].corr()

plt.figure(figsize=(15,12))
sns.heatmap(df_corr, cmap="coolwarm", annot=False)
plt.title("Combined Correlation Heatmap — All Players")
plt.show()
```


# KMeans Clustering

```{python}
clean = df_players[metrics].dropna()
scaler = StandardScaler()
X = scaler.fit_transform(clean)

kmeans = KMeans(n_clusters=4, n_init=10)
labels = kmeans.fit_predict(X)

plt.figure(figsize=(8,6))
sns.scatterplot(x=X[:,0], y=X[:,1], hue=labels, palette="tab10")
plt.title("KMeans Clustering — Player Performance Metrics")
plt.show()
```
# Strategy Change Over time

```{python}
time_metrics = [
    "GoldPerTurn", "SciencePerTurn", "CulturePerTurn",
    "FaithPerTurn", "TourismPerTurn", "HappinessPercentage"
]

def plot_time_comparison(metric):
    plt.figure(figsize=(10,5))
    for p in sorted(df_players["ActivePlayer"].dropna().unique()):
        sub = df_players[df_players["ActivePlayer"] == p]
        sns.lineplot(
            data=sub,
            x="Turn",
            y=metric,
            label=f"Player {p}",
            linewidth=1.7
        )
    plt.title(f"{metric} Over Time")
    plt.xlabel("Turn")
    plt.ylabel(metric)
    plt.grid(True, alpha=0.3)
    plt.legend()
    plt.tight_layout()
    plt.show()

for m in time_metrics:
    plot_time_comparison(m)
```
# Radar Chart of Clusters


```{python}
radar_metrics = [
    "GoldPerTurn", "SciencePerTurn", "CulturePerTurn",
    "FaithPerTurn", "TourismPerTurn", "Population",
    "Territory", "Cities"
]

player_profiles = (
    df_players.groupby("ActivePlayer")[radar_metrics]
    .mean()
    .dropna()
)

scaled = StandardScaler().fit_transform(player_profiles)
player_profiles_norm = pd.DataFrame(
    scaled,
    index=player_profiles.index,
    columns=radar_metrics
)

def radar_plot(df, title):
    categories = list(df.columns)
    N = len(categories)
    values = df.values.flatten().tolist()
    values += values[:1]

    angles = np.linspace(0, 2*np.pi, N, endpoint=False).tolist()
    angles += angles[:1]

    plt.figure(figsize=(6,6))
    ax = plt.subplot(111, polar=True)
    ax.plot(angles, values, linewidth=2)
    ax.fill(angles, values, alpha=0.25)
    ax.set_xticks(angles[:-1])
    ax.set_xticklabels(categories)
    plt.title(title)
    plt.show()

for p in player_profiles_norm.index:
    radar_plot(player_profiles_norm.loc[[p]], f"Radar Strategy Profile — Player {p}")
```


## Code


# Fit a linear regression model


# Summary of the model

```

## Plots

```{python}

```

## Plot and text

::: columns
::: {.column width="50%"}
-   Some text

-   goes here
:::

::: {.column width="50%"}
```{python}
#| warning: false
#| fig.width: 5.5

```
:::
:::

# A new section...

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,



## Images

![Image credit: Danielle Navarro, Percolate.](images/watercolour_sys02_img34_teacup-ocean.png){fig-align="center" width="500"}

## Math Expressions {.smaller}

You can write LaTeX math expressions inside a pair of dollar signs, e.g. \$\\alpha+\\beta\$ renders $\alpha + \beta$. You can use the display style with double dollar signs:

```         
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$
\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i
$$

Limitations:

1.  The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

2.  There should not be spaces after the opening `$` or before the closing `$`.

# Wrap up

## Feeling adventurous?

-   You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

-   But some of you might want to play around with slide styling. Some solutions for this can be found at https://quarto.org/docs/presentations/revealjs.
